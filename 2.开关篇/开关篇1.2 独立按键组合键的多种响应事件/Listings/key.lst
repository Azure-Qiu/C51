C51 COMPILER V9.60.7.0   KEY                                                               01/29/2025 11:58:01 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Objects\key.obj
COMPILER INVOKED BY: C:\Software\Keil\C51\BIN\C51.EXE key.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings
                    -\key.lst) OBJECT(.\Objects\key.obj)

line level    source

   1          #include "key.h"
   2          #include "led.h"
   3          #include "smg.h"
   4          /** 
   5           **  @brief    ç‹¬ç«‹æŒ‰é”®çš„å‡½æ•°å°è£…
   6           **            1. å•é”®çš„å•æ¬¡æˆ–è¿ç»­å“åº”ä¼˜åŒ–
   7           **            2. ç»„åˆé”®çš„å•æ¬¡æˆ–è¿ç»­å“åº”ä¼˜åŒ–
   8           **  @author   QIU
   9           **  @date     2024.01.31
  10           **/
  11          
  12          /*-------------------------------------------------------------------*/
  13          // æŒ‰é”®çŠ¶æ€ã€å‰çŠ¶æ€
  14          Key_State key_now_state, key_pre_state;
  15          
  16          // æŒ‰é”®ç´¯ç§¯
  17          u16 num = 0;
  18          // LEDé€Ÿåº¦
  19          u16 led_speed = 10000;
  20          
  21          
  22          
  23          /**
  24           **  @brief   æŒ‰é”®1æŒ‰ä¸‹å‡½æ•°ï¼ˆå¯ä»¥æŒ‰éœ€æ±‚ä¿®æ”¹ï¼‰
  25           **  @param   æ— 
  26           **  @retval  æ— 
  27           **/
  28          void key1_pressed(){
  29   1              smg_showChar('1', 1, false);
  30   1              led_turn(6);
  31   1      }
  32          
  33          
  34          /**
  35           **  @brief   æŒ‰é”®2æŒ‰ä¸‹å‡½æ•°ï¼ˆå¯ä»¥æŒ‰éœ€æ±‚ä¿®æ”¹ï¼‰
  36           **  @param   æ— 
  37           **  @retval  æ— 
  38           **/
  39          void key2_pressed(){
  40   1              ;
  41   1      }
  42          
  43          
  44          /**
  45           **  @brief   æŒ‰é”®3æŒ‰ä¸‹å‡½æ•°ï¼ˆå¯ä»¥æŒ‰éœ€æ±‚ä¿®æ”¹ï¼‰
  46           **  @param   æ— 
  47           **  @retval  æ— 
  48           **/
  49          void key3_pressed(){
  50   1              smg_showChar('3', 1, false);
  51   1              led_turn(8);
  52   1      }
  53          
  54          
C51 COMPILER V9.60.7.0   KEY                                                               01/29/2025 11:58:01 PAGE 2   

  55          /**
  56           **  @brief   æŒ‰é”®4æŒ‰ä¸‹å‡½æ•°ï¼ˆå¯ä»¥æŒ‰éœ€æ±‚ä¿®æ”¹ï¼‰
  57           **  @param   æ— 
  58           **  @retval  æ— 
  59           **/
  60          void key4_pressed(){
  61   1              u8 str[8];
  62   1              num++;
  63   1              sprintf(str,"%d",num/10);
  64   1              smg_showString(str, 1);
  65   1      }
  66          
  67          
  68          /**
  69           **  @brief   ç»„åˆé”®1å’Œ2æŒ‰ä¸‹å‡½æ•°ï¼ˆå¯ä»¥æŒ‰éœ€æ±‚ä¿®æ”¹ï¼‰
  70           **  @param   æ— 
  71           **  @retval  æ— 
  72           **/
  73          void key_1_2_pressed(){
  74   1              smg_showChar('a', 1, false);
  75   1              led_stream(led_speed);
  76   1      }
  77          
  78          
  79          /**
  80           **  @brief   ç»„åˆé”®2å’Œ3æŒ‰ä¸‹å‡½æ•°ï¼ˆå¯ä»¥æŒ‰éœ€æ±‚ä¿®æ”¹ï¼‰
  81           **  @param   æ— 
  82           **  @retval  æ— 
  83           **/
  84          void key_2_3_pressed(){
  85   1              smg_showChar('b', 1, false);
  86   1              led_run(led_speed);
  87   1      }
  88          
  89          
  90          /**
  91           **  @brief   ç»„åˆé”®3å’Œ4æŒ‰ä¸‹å‡½æ•°ï¼ˆå¯ä»¥æŒ‰éœ€æ±‚ä¿®æ”¹ï¼‰
  92           **  @param   æ— 
  93           **  @retval  æ— 
  94           **/
  95          void key_3_4_pressed(){
  96   1              u8 str[8];
  97   1              led_speed += 100;
  98   1              sprintf(str,"%u",led_speed); // æ— ç¬¦å·æ•°
  99   1              smg_showString(str, 1);
 100   1      }
 101          
 102          
 103          
 104          /**
 105           **  @brief   æŒ‰é”®1æ¾å¼€å‡½æ•°ï¼ˆå¯ä»¥æŒ‰éœ€æ±‚ä¿®æ”¹ï¼‰
 106           **  @param   æ— 
 107           **  @retval  æ— 
 108           **/
 109          void key1_unpressed(){
 110   1              ;
 111   1      }
 112          
 113          
 114          /**
 115           **  @brief   æŒ‰é”®2æ¾å¼€å‡½æ•°ï¼ˆå¯ä»¥æŒ‰éœ€æ±‚ä¿®æ”¹ï¼‰
 116           **  @param   æ— 
C51 COMPILER V9.60.7.0   KEY                                                               01/29/2025 11:58:01 PAGE 3   

 117           **  @retval  æ— 
 118           **/
 119          void key2_unpressed(){
 120   1              smg_showChar('2', 1, false);
 121   1              led_turn(7);
 122   1      }
 123          
 124          
 125          /**
 126           **  @brief   æŒ‰é”®3æ¾å¼€å‡½æ•°ï¼ˆå¯ä»¥æŒ‰éœ€æ±‚ä¿®æ”¹ï¼‰
 127           **  @param   æ— 
 128           **  @retval  æ— 
 129           **/
 130          void key3_unpressed(){
 131   1              key3_pressed();
 132   1      }
 133          
 134          
 135          /**
 136           **  @brief   æŒ‰é”®4æ¾å¼€å‡½æ•°ï¼ˆå¯ä»¥æŒ‰éœ€æ±‚ä¿®æ”¹ï¼‰
 137           **  @param   æ— 
 138           **  @retval  æ— 
 139           **/
 140          void key4_unpressed(){
 141   1              smg_showChar('0', 1, false);
 142   1              num = 0;
 143   1      }
 144          
 145          
 146          /**
 147           **  @brief   æŒ‰é”®1ã€2æ¾å¼€å‡½æ•°ï¼ˆå¯ä»¥æŒ‰éœ€æ±‚ä¿®æ”¹ï¼‰
 148           **  @param   æ— 
 149           **  @retval  æ— 
 150           **/
 151          void key1_2_unpressed(){
 152   1              ;
 153   1      }
 154          
 155          
 156          /**
 157           **  @brief   æŒ‰é”®2ã€3æ¾å¼€å‡½æ•°ï¼ˆå¯ä»¥æŒ‰éœ€æ±‚ä¿®æ”¹ï¼‰
 158           **  @param   æ— 
 159           **  @retval  æ— 
 160           **/
 161          void key2_3_unpressed(){
 162   1              ;
 163   1      }
 164          
 165          /**
 166           **  @brief   æŒ‰é”®3ã€4æ¾å¼€å‡½æ•°ï¼ˆå¯ä»¥æŒ‰éœ€æ±‚ä¿®æ”¹ï¼‰
 167           **  @param   æ— 
 168           **  @retval  æ— 
 169           **/
 170          void key3_4_unpressed(){
 171   1              ;
 172   1      }
 173          
 174          
 175          /*-------------------------------------------------------------------*/
 176          
 177          
 178          /**
C51 COMPILER V9.60.7.0   KEY                                                               01/29/2025 11:58:01 PAGE 4   

 179           **  @brief   æŒ‰é”®æ¾å¼€å“åº”
 180           **  @param   æ— 
 181           **  @retval  æ— 
 182           **/
 183          void key_unpress(){
 184   1              switch(key_pre_state){
 185   2                      case KEY_UNPRESS: break;
 186   2                      case KEY1_PRESS: key1_unpressed();break;
 187   2                      case KEY2_PRESS: key2_unpressed();break;
 188   2                      case KEY3_PRESS: key3_unpressed();break;
 189   2                      case KEY4_PRESS: key4_unpressed();break;
 190   2                      case KEY1_2_PRESS: key1_2_unpressed();break;
 191   2                      case KEY2_3_PRESS: key2_3_unpressed();break;
 192   2                      case KEY3_4_PRESS: key3_4_unpressed();break;
 193   2              }
 194   1      }
 195          
 196          
 197          /**
 198           **  @brief   ï¼ˆè½®è¯¢æ–¹å¼ï¼‰æ‰«æç‹¬ç«‹æŒ‰é”®ï¼Œåˆ¤æ–­å“ªä¸ªé”®æŒ‰ä¸‹
 199           **  @param   æ— 
 200           **  @retval  æ— 
 201           **/
 202          void scan_key(){
 203   1              static u8 flag = 1;
 204   1      
 205   1              // å¦‚æœæœ‰æŒ‰é”®æŒ‰ä¸‹ï¼ˆæŒ‰ä¸‹è¿‡ç¨‹ä¸­å±è”½å…¶ä»–æŒ‰é”®ï¼Œåªæœ‰å…¨éƒ¨æ¾å¼€ä¹‹åæ‰å†æ¬¡æ£€æµ‹ï¼‰
 206   1              if(flag && (!key1||!key2||!key3||!key4)){
 207   2                      flag = 0; // æ¸…é›¶
 208   2                      delay_ms(10); // å»¶æ—¶10msæ¶ˆæŠ–
 209   2                      delay_ms(50); // å»¶æ—¶50msç»„åˆé”®å®¹è®¸é—´éš”
 210   2                      // è·å–å½“å‰æ‰€æœ‰æŒ‰ä¸‹çš„é”®
 211   2                      if(!key1) key_now_state |= KEY1_PRESS; 
 212   2                      if(!key2) key_now_state |= KEY2_PRESS; 
 213   2                      if(!key3) key_now_state |= KEY3_PRESS; 
 214   2                      if(!key4) key_now_state |= KEY4_PRESS; 
 215   2      
 216   2              // å¦‚æœæŒ‰é”®å…¨éƒ¨æ¾å¼€
 217   2              }else if(key1 && key2 && key3 && key4){
 218   2                      flag = 1;
 219   2                      delay_ms(10); // å»¶æ—¶10msæ¶ˆæŠ–,æ¾å¼€å“åº”æœ‰é€»è¾‘åˆ¤æ–­æ—¶ï¼Œéœ€è¦åŠ ä¸Šæ¶ˆæŠ–ã€‚å¦åˆ™å¯ä»¥çœç
             -•¥ã€‚
 220   2                      if(key1 && key2 && key3 && key4) key_now_state = 0;
 221   2              }
 222   1      }
 223          
 224          
 225          
 226          /**
 227           **  @brief   ï¼ˆè½®è¯¢æ–¹å¼ï¼‰åˆ¤æ–­æŒ‰é”®, è¿›è¡Œç›¸åº”å¤„ç†
 228           **  @param    æ— 
 229           **  @retval   æ— 
 230           **/
 231          void check_key(){
 232   1              switch(key_now_state){
 233   2                      case KEY_UNPRESS:
 234   2                              // æ¾å¼€å“åº”
 235   2                              key_unpress();
 236   2                              key_pre_state = KEY_UNPRESS;
 237   2                              break;
 238   2                      case KEY1_PRESS:
 239   2                              key_pre_state = KEY1_PRESS;
C51 COMPILER V9.60.7.0   KEY                                                               01/29/2025 11:58:01 PAGE 5   

 240   2                              // å¦‚æœæ˜¯å•æ¬¡å“åº”
 241   2                              if(!KEY1_MODE) key_now_state = KEY_NON_DEAL;
 242   2                              key1_pressed();
 243   2                              break;
 244   2                      case KEY2_PRESS:
 245   2                              key_pre_state = KEY2_PRESS;
 246   2                              if(!KEY2_MODE) key_now_state = KEY_NON_DEAL;
 247   2                              break;
 248   2                      case KEY3_PRESS:
 249   2                              key_pre_state = KEY3_PRESS;
 250   2                              if(!KEY3_MODE) key_now_state = KEY_NON_DEAL;
 251   2                              key3_pressed();
 252   2                              break;
 253   2                      case KEY4_PRESS:
 254   2                              key_pre_state = KEY4_PRESS;
 255   2                              if(!KEY4_MODE) key_now_state = KEY_NON_DEAL;
 256   2                              key4_pressed();
 257   2                              break;
 258   2                      case KEY1_2_PRESS:
 259   2                              key_pre_state = KEY1_2_PRESS;
 260   2                              if(!KEY_1_2_MODE) key_now_state = KEY_NON_DEAL;
 261   2                              key_1_2_pressed();
 262   2                              break;
 263   2                      case KEY2_3_PRESS:
 264   2                              key_pre_state = KEY2_3_PRESS;
 265   2                              if(!KEY_2_3_MODE) key_now_state = KEY_NON_DEAL;
 266   2                              key_2_3_pressed();
 267   2                              break;
 268   2                      case KEY3_4_PRESS:
 269   2                              key_pre_state = KEY3_4_PRESS;
 270   2                              if(!KEY_3_4_MODE) key_now_state = KEY_NON_DEAL;
 271   2                              key_3_4_pressed();
 272   2                              break;
 273   2                      case KEY_NON_DEAL:
 274   2                              // æŒ‰ä¸‹ä¸å¤„ç†
 275   2                              break;
 276   2              }
 277   1      }
 278          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    431    ----
   CONSTANT SIZE    =      6    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7      16
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
