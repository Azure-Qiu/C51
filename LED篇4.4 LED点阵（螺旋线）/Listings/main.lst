C51 COMPILER V9.60.0.0   MAIN                                                              01/01/2023 18:06:37 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\MDK5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.ls
                    -t) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include <INTRINS.H>
   3          #define LED_PORT P0
   4          #define SPEED 30
   5          
   6          typedef unsigned char u8;
   7          typedef unsigned int u16;
   8          
   9          sbit SER = P3^4; //串行数据输入引脚
  10          sbit ST_CP = P3^5; //存储寄存器时钟引脚
  11          sbit SH_CP = P3^6; //移位寄存器时钟引脚
  12          
  13          //全局变量
  14          u8 x,y,num_step,count,dir,posY[8] = {0};
  15          
  16          //延时函数
  17          void delay(u16 t){
  18   1              while(t--);
  19   1      }
  20          
  21          //生成对应位置的二进制代码
  22          u8 produce_B_Code(u8 pos){      
  23   1              return 0x01<<pos;
  24   1      }
  25          
  26          //串行数据生成对应并行数据
  27          void Ser2Para(u8 dat){
  28   1              u8 i;
  29   1              for(i=0;i<8;i++){
  30   2                      SER = dat>>7;
  31   2                      dat <<= 1;
  32   2                      SH_CP = 0;
  33   2                      _nop_(); // 延迟一个机器周期
  34   2                      SH_CP = 1; //获得一个上升沿
  35   2                      _nop_(); 
  36   2              }
  37   1              ST_CP = 0;
  38   1              _nop_();
  39   1              ST_CP = 1;
  40   1              _nop_();
  41   1      }
  42          
  43          void clear_LED(){
  44   1              LED_PORT = 0xff; //清屏
  45   1              Ser2Para(0x00); 
  46   1      }
  47          
  48          
  49          //显示每帧画面
  50          void display(u8 XDATA,u8 YDATA){
  51   1              LED_PORT = ~produce_B_Code(XDATA); //按列由右往左扫描
  52   1              Ser2Para(YDATA);
  53   1              delay(100);
  54   1              clear_LED(); //消影
C51 COMPILER V9.60.0.0   MAIN                                                              01/01/2023 18:06:37 PAGE 2   

  55   1      }
  56          
  57          //更新方向与数组
  58          void update_posY(u8 dir){
  59   1              //判断方向
  60   1              switch(dir%4){
  61   2                      case 0: //向下
  62   2                      {
  63   3                              y = y - 1; //更新当前点坐标
  64   3                              posY[x] += produce_B_Code(y); //更新需要点亮的Y坐标码
  65   3                              break;
  66   3                      }
  67   2                      case 1: //向右
  68   2                      {
  69   3                              x = x - 1;
  70   3                              posY[x] += produce_B_Code(y); //更新需要点亮的Y坐标码
  71   3                              break;
  72   3                      }
  73   2                              
  74   2                      case 2: //向上
  75   2                      {
  76   3                              y = y + 1; //更新当前点坐标
  77   3                              posY[x] += produce_B_Code(y); //更新需要点亮的Y坐标码
  78   3                              break;
  79   3                      }
  80   2                      case 3: //向左(往高位走)
  81   2                      {
  82   3                              x = x + 1; //更新当前点坐标
  83   3                              posY[x] += produce_B_Code(y); //更新需要点亮的Y坐标码
  84   3                              break;
  85   3                      }
  86   2              }
  87   1      }
  88          
  89          //重启
  90          void reset(){
  91   1              u8 k;
  92   1              x = 4,y = 4,num_step = 1,count=0,dir=0;
  93   1              for(k=0;k<8;k++){
  94   2                      if(k == x){
  95   3                              posY[x] = produce_B_Code(y);//记录初始化的值
  96   3                      }else{
  97   3                              posY[k] = 0;
  98   3                      }
  99   2              }
 100   1      }
 101          
 102          
 103          /* 
 104          count: 记录每个动作(上下，左右)需要执行几次
 105          x,y:记录当前点的坐标
 106          posY[]:记录当前需要点亮的灯的十六进制码
 107          */
 108          void main(){
 109   1              u8 i,j=0;
 110   1              reset(); //初始化
 111   1              while(1){
 112   2                      for(i=0;i<8;i++){
 113   3                              //逆时针
 114   3                              display(i,posY[i]); //把数组传过去
 115   3                      }
 116   2                      count++;
C51 COMPILER V9.60.0.0   MAIN                                                              01/01/2023 18:06:37 PAGE 3   

 117   2                      //下一帧
 118   2                      if(count > SPEED){
 119   3                              count = 0;
 120   3                              //更新一下posY数组，显示下一个点
 121   3                              update_posY(dir);
 122   3                              //记录每更改一次方向需要几帧
 123   3                              j++;
 124   3                              //每两组换向多走一步
 125   3                              num_step = dir/2 + 1;
 126   3                              //更新方向
 127   3                              if(j>=num_step){
 128   4                                      dir++;
 129   4                                      j=0; //复位
 130   4                              }
 131   3                      }
 132   2                      //结束条件
 133   2                      if(x==0 && y==8){
 134   3                              delay(10000); //保持画面
 135   3                              clear_LED(); //清屏
 136   3                              delay(50000);
 137   3                              reset(); //重新开始
 138   3                      }
 139   2              }
 140   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    298    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     13    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
