C51 COMPILER V9.60.7.0   KEY                                                               02/08/2024 14:01:26 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Objects\key.obj
COMPILER INVOKED BY: C:\Software\Keil\C51\BIN\C51.EXE key.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings
                    -\key.lst) OBJECT(.\Objects\key.obj)

line level    source

   1          #include "key.h"
   2          // åŒ…å«çš„å¤´æ–‡ä»¶ï¼ˆæŒ‰éœ€æ±‚ä¿®æ”¹ï¼‰
   3          #include "led.h"
   4          #include "smg.h"
   5          /** 
   6           **  @brief    ç‹¬ç«‹æŒ‰é”®çš„å®šæ—¶å™¨å®ç°
   7           **            1. å•é”®çš„æŒ‰ä¸‹å“åº”ä¸æ¾å¼€å“åº”
   8           **            2. å•é”®çš„å•æ¬¡å“åº”ä¸è¿ç»­å“åº”
   9           **  @author   QIU
  10           **  @date     2023.08.31
  11           **/
  12           
  13          /*-------------------------------------------------------------------*/
  14          
  15          // å®æ—¶æŒ‰é”®çŠ¶æ€ã€å½“å‰ç¡®è®¤çŠ¶æ€ã€å‰ç¡®è®¤çŠ¶æ€
  16          Key_State key_state, key_now_state, key_pre_state;
  17          // æŒ‰é”®ç´¯ç§¯
  18          u16 num = 0;
  19          
  20          
  21          /*------------------------æŒ‰é”®å“åº”å‡½æ•°å®šä¹‰åŒº------------------------------*/
  22          
  23          
  24          /**
  25           **  @brief   æŒ‰é”®3æŒ‰é”®å“åº”
  26           **  @param   å‚æ•°è¯´æ˜
  27           **  @retval  è¿”å›å€¼
  28           **/
  29          void key3_press(){
  30   1              num++;
  31   1              smg_showInt(num, 1);
  32   1              led_on(1);
  33   1      }
  34          
  35          
  36          
  37          void key3_unpressed(){
  38   1              num = 0;
  39   1              smg_showChar('0', 1, false);
  40   1              led_turn(1);
  41   1      }
  42          
  43          
  44          
  45          /*--------------------------å»¶æ—¶æ³•æŒ‰é”®æ£€æµ‹------------------------------------*/
  46          
  47          /**
  48           **  @brief   æŒ‰é”®æ¾å¼€å“åº”
  49           **  @param   æ— 
  50           **  @retval  æ— 
  51           **/
  52          void key_unpress(){
  53   1              switch(key_pre_state){
  54   2                      case KEY_UNPRESS: break;
C51 COMPILER V9.60.7.0   KEY                                                               02/08/2024 14:01:26 PAGE 2   

  55   2                      case KEY3_PRESS: key3_unpressed();break;
  56   2              }
  57   1      }
  58          
  59          
  60          #if 0
              
              /**
               **  @brief   æŒ‰é”®æ¾å¼€å“åº”
               **  @param   æ— 
               **  @retval  æ— 
               **/
              void key_unpress(){
                      switch(key_pre_state){
                              case KEY_UNPRESS: break;
                              case KEY1_PRESS: key1_unpressed();break;
                              case KEY2_PRESS: key2_unpressed();break;
                              case KEY3_PRESS: key3_unpressed();break;
                              case KEY4_PRESS: key4_unpressed();break;
                              case KEY1_2_PRESS: key1_2_unpressed();break;
                              case KEY2_3_PRESS: key2_3_unpressed();break;
                              case KEY3_4_PRESS: key3_4_unpressed();break;
                      }
              }
              
              
              /**
               **  @brief   ï¼ˆè½®è¯¢æ–¹å¼ï¼‰æ‰«æç‹¬ç«‹æŒ‰é”®ï¼Œåˆ¤æ–­å“ªä¸ªé”®æŒ‰ä¸‹
               **  @param   æ— 
               **  @retval  æ— 
               **/
              void scan_key(){
                      static u8 flag = 1;
              
                      // å¦‚æœæœ‰æŒ‰é”®æŒ‰ä¸‹
                      if(flag && (!key1||!key2||!key3||!key4)){
                              flag = 0; // æ¸…é›¶
                              delay_ms(10); // å»¶æ—¶10msæ¶ˆæŠ–
                              delay_ms(50); // å»¶æ—¶50ms å®¹è®¸é—´éš”
                              // è·å–å½“å‰æ‰€æœ‰æŒ‰ä¸‹çš„é”®
                              if(!key1) key_now_state |= KEY1_PRESS; 
                              if(!key2) key_now_state |= KEY2_PRESS; 
                              if(!key3) key_now_state |= KEY3_PRESS; 
                              if(!key4) key_now_state |= KEY4_PRESS; 
              
                      // å¦‚æœæŒ‰é”®å…¨éƒ¨æ¾å¼€
                      }else if(key1&&key2&&key3&&key4){
                              flag = 1;
                              delay_ms(10); // å»¶æ—¶10msæ¶ˆæŠ–,æ¾å¼€å“åº”æœ‰é€»è¾‘åˆ¤æ–­æ—¶ï¼Œéœ€è¦åŠ ä¸Šæ¶ˆæŠ–ã€‚å¦åˆ™å¯ä»¥çœç
             -•¥ã€‚
                              if(key1&&key2&&key3&&key4)key_now_state = 0;
                      }
              }
              
              
              
              /**
               **  @brief   ï¼ˆè½®è¯¢æ–¹å¼ï¼‰åˆ¤æ–­æŒ‰é”®, è¿›è¡Œç›¸åº”å¤„ç†
               **  @param    æ— 
               **  @retval   æ— 
               **/
              void check_key(){
C51 COMPILER V9.60.7.0   KEY                                                               02/08/2024 14:01:26 PAGE 3   

                      switch(key_now_state){
                              case KEY_UNPRESS:
                                      // æ¾å¼€å“åº”
                                      key_unpress();
                                      key_pre_state = KEY_UNPRESS;
                                      break;
                              case KEY1_PRESS:
                                      key_pre_state = KEY1_PRESS;
                                      // å¦‚æœæ˜¯å•æ¬¡å“åº”
                                      if(!KEY1_MODE) key_now_state = KEY_NON_DEAL;
                                      key1_pressed();
                                      break;
                              case KEY2_PRESS:
                                      key_pre_state = KEY2_PRESS;
                                      if(!KEY2_MODE) key_now_state = KEY_NON_DEAL;
                                      break;
                              case KEY3_PRESS:
                                      key_pre_state = KEY3_PRESS;
                                      if(!KEY3_MODE) key_now_state = KEY_NON_DEAL;
                                      key3_pressed();
                                      break;
                              case KEY4_PRESS:
                                      key_pre_state = KEY4_PRESS;
                                      if(!KEY4_MODE) key_now_state = KEY_NON_DEAL;
                                      key4_pressed();
                                      break;
                              case KEY1_2_PRESS:
                                      key_pre_state = KEY1_2_PRESS;
                                      if(!KEY_1_2_MODE) key_now_state = KEY_NON_DEAL;
                                      key_1_2_pressed();
                                      break;
                              case KEY2_3_PRESS:
                                      key_pre_state = KEY2_3_PRESS;
                                      if(!KEY_2_3_MODE) key_now_state = KEY_NON_DEAL;
                                      key_2_3_pressed();
                                      break;
                              case KEY3_4_PRESS:
                                      key_pre_state = KEY3_4_PRESS;
                                      if(!KEY_3_4_MODE) key_now_state = KEY_NON_DEAL;
                                      key_3_4_pressed();
                                      break;
                              case KEY_NON_DEAL:
                                      // æŒ‰ä¸‹ä¸å¤„ç†
                                      break;
                      }
              }
              #endif
 163          
 164          
 165          /*---------------------------å®šæ—¶å™¨æ³•æŒ‰é”®æ£€æµ‹--------------------------------*/
 166          
 167          
 168          
 169          /**
 170           **  @brief   ï¼ˆè½®è¯¢æ–¹å¼ï¼‰åˆ¤æ–­æŒ‰é”®çŠ¶æ€ä¸æ¨¡å¼, è¿›è¡Œç›¸åº”å¤„ç†
 171           **  @param    æ— 
 172           **  @retval   æ— 
 173           **/
 174          void check_key(){
 175   1              static bit flag = true;
 176   1              // æ£€æŸ¥æŒ‰é”®æ¨¡å¼
 177   1              switch(key_now_state){
C51 COMPILER V9.60.7.0   KEY                                                               02/08/2024 14:01:26 PAGE 4   

 178   2                      case KEY3_PRESS:
 179   2                              // æŒ‰ä¸‹å“åº”
 180   2                              if(flag) key3_press();
 181   2                              // æŒ‰é”®æ¨¡å¼æµè½¬
 182   2                              if(!KEY3_MODE) flag = false;
 183   2                              break;
 184   2                      case KEY_UNPRESS:
 185   2                              // æŒ‰ä¸‹å“åº”
 186   2                              key_unpress();
 187   2                              key_pre_state = KEY_UNPRESS;
 188   2                              flag = true;
 189   2                              break;
 190   2                      default:
 191   2                              break;
 192   2              }
 193   1              
 194   1      }
 195          
 196          
 197          
 198          
 199          /**
 200           **  @brief   ï¼ˆå®šæ—¶å™¨ï¼‰ç¡®è®¤æŒ‰é”®æ˜¯å¦ç¨³å®šæŒ‰ä¸‹/æ¾å¼€ï¼Œå»æŠ–
 201           **  @param   æ— 
 202           **  @retval  æ— 
 203           **/
 204          void scan_key_ByTimer(){
 205   1              static u8 flag = 0xff;
 206   1              
 207   1              flag <<= 1;
 208   1      
 209   1              flag |= key3; // æ£€æŸ¥é”®3å¼•è„šçŠ¶æ€ï¼ˆæŒ‰ä¸‹ä¸º0ï¼‰
 210   1              
 211   1              switch(flag){
 212   2                      case 0xff:
 213   2                              // è¿ç»­8æ¬¡æ£€æµ‹åˆ°æŒ‰é”®æ¾å¼€ï¼Œè§†ä¸ºæ¾å¼€çŠ¶æ€ã€‚
 214   2                              key_state = KEY_UNPRESS;
 215   2                              // æŒ‰é”®çŠ¶æ€æ›´æ–°
 216   2                              key_pre_state = key_now_state;
 217   2                              key_now_state = key_state;
 218   2                              break;
 219   2                      
 220   2                      case 0x00:
 221   2                              // æ›´æ–°æŒ‰é”®çŠ¶æ€
 222   2                              key_pre_state = key_now_state;
 223   2                              key_now_state = key_state;
 224   2                              break;
 225   2              }
 226   1      }
 227          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    104    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
